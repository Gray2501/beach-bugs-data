<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    <title>Beach Bugs - Quadrat Data</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-bottom: 20px;
        }
        
        .header {
            background: rgba(255,255,255,0.95);
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 {
            font-size: 20px;
            color: #2d3748;
            margin: 0;
        }
        
        .header .subtitle {
            font-size: 13px;
            color: #718096;
            margin-top: 2px;
        }
        
        .status-bar {
            background: #48bb78;
            color: white;
            padding: 8px 20px;
            font-size: 13px;
            display: none;
        }
        
        .status-bar.show {
            display: block;
        }
        
        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 0 15px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 6px;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.2s;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .photo-section {
            border: 3px dashed #cbd5e0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f7fafc;
        }
        
        .photo-section.has-photo {
            border-color: #48bb78;
            background: #f0fff4;
        }
        
        .photo-section:active {
            transform: scale(0.98);
        }
        
        .photo-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .photo-text {
            color: #4a5568;
            font-weight: 600;
        }
        
        .photo-preview {
            max-width: 100%;
            max-height: 300px;
            margin-top: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .photo-preview.show {
            display: block;
        }
        
        .cover-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .count-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .count-item label {
            margin: 0;
            flex: 1;
            font-size: 14px;
        }
        
        .count-item input {
            width: 70px;
            padding: 8px;
            text-align: center;
            font-weight: 600;
        }
        
        .stats-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .stats-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .stats-row:last-child {
            margin-bottom: 0;
        }
        
        .stats-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .stats-value {
            font-size: 20px;
            font-weight: 700;
        }
        
        .total-check {
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            font-weight: 600;
            font-size: 15px;
        }
        
        .total-good {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .total-bad {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .button {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .button:active {
            transform: scale(0.97);
        }
        
        .button-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .button-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }
        
        .button-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            margin-top: 10px;
        }
        
        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .alert-success {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .alert-info {
            background: #bee3f8;
            color: #2c5282;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 25px;
            max-width: 400px;
            width: 100%;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #2d3748;
        }
        
        .help-text {
            font-size: 12px;
            color: #718096;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü¶Ä Beach Bugs - Quadrat Data</h1>
        <div class="subtitle">EVSC 400 Field Data Collection</div>
    </div>
    
    <div class="status-bar" id="statusBar">
        ‚úì Saved <span id="savedCount">0</span> quadrats
    </div>
    
    <div class="container">
        <form id="dataForm">
            <!-- Site & Quadrat Info -->
            <div class="card">
                <div class="section-title">üìç Site & Quadrat Info</div>
                
                <div class="form-group">
                    <label>Site ID</label>
                    <select id="siteId" required>
                        <option value="">Select...</option>
                        <option value="Site_1">Site 1</option>
                        <option value="Site_2">Site 2</option>
                        <option value="Site_3">Site 3</option>
                        <option value="Site_4">Site 4</option>
                        <option value="Site_5">Site 5</option>
                        <option value="Site_6">Site 6</option>
                        <option value="Site_7">Site 7</option>
                        <option value="Site_8">Site 8</option>
                        <option value="Site_9">Site 9</option>
                        <option value="Site_10">Site 10</option>
                        <option value="Site_11">Site 11</option>
                        <option value="Site_12">Site 12</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Site Name <span class="help-text">(backup - e.g., "Belcarra")</span></label>
                    <input type="text" id="siteName" placeholder="Location name" required>
                </div>
                
                <div class="form-group">
                    <label>Your Name</label>
                    <input type="text" id="samplerName" placeholder="Who's collecting this?" required>
                </div>
                
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="date" required>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="form-group">
                        <label>Side</label>
                        <select id="side" required>
                            <option value="">Choose...</option>
                            <option value="Left">Left</option>
                            <option value="Right">Right</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Distance</label>
                        <select id="distance" required>
                            <option value="">Choose...</option>
                            <option value="5">5m (Near)</option>
                            <option value="15">15m (Mid)</option>
                            <option value="30">30m (Far)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Zone</label>
                    <select id="zone" required>
                        <option value="">Choose...</option>
                        <option value="Mid">Mid</option>
                        <option value="Lower">Lower</option>
                        <option value="Mid-Lower">Mid-Lower (compressed)</option>
                    </select>
                </div>
            </div>
            
            <!-- Photo -->
            <div class="card">
                <div class="section-title">üì∏ Photo</div>
                <label class="photo-section" for="photoInput" id="photoSection">
                    <div class="photo-icon">üì∑</div>
                    <div class="photo-text" id="photoText">Tap to take photo</div>
                    <input type="file" id="photoInput" accept="image/*" capture="environment" style="display: none;">
                    <img id="photoPreview" class="photo-preview" alt="Preview">
                </label>
            </div>
            
            <!-- Cover -->
            <div class="card">
                <div class="section-title">ü™® Cover Estimates (%)</div>
                <p class="help-text">Visual estimate, nearest 5%. Should total 100%.</p>
                
                <div class="cover-grid">
                    <div class="form-group">
                        <label>Algae</label>
                        <input type="number" id="coverAlgae" min="0" max="100" step="5" value="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Barnacles</label>
                        <input type="number" id="coverBarnacle" min="0" max="100" step="5" value="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Mussels</label>
                        <input type="number" id="coverMussel" min="0" max="100" step="5" value="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Bare Rock</label>
                        <input type="number" id="coverBareRock" min="0" max="100" step="5" value="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Sand</label>
                        <input type="number" id="coverSand" min="0" max="100" step="5" value="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Other</label>
                        <input type="number" id="coverOther" min="0" max="100" step="5" value="0" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Describe "Other"</label>
                    <input type="text" id="coverOtherDesc" placeholder="e.g., encrusting sponge">
                </div>
                
                <div id="totalCheck" class="total-check"></div>
            </div>
            
            <!-- Counts -->
            <div class="card">
                <div class="section-title">üêö Organism Counts</div>
                <p class="help-text">Count all visible individuals. Enter 0 if none.</p>
                
                <div class="count-item">
                    <label>Snails</label>
                    <input type="number" id="countSnails" min="0" value="0" required>
                </div>
                
                <div class="count-item">
                    <label>Limpets</label>
                    <input type="number" id="countLimpets" min="0" value="0" required>
                </div>
                
                <div class="count-item">
                    <label>Crabs</label>
                    <input type="number" id="countCrabs" min="0" value="0" required>
                </div>
                
                <div class="count-item">
                    <label>Isopods</label>
                    <input type="number" id="countIsopods" min="0" value="0" required>
                </div>
                
                <div class="count-item">
                    <label>Sea Stars</label>
                    <input type="number" id="countStars" min="0" value="0" required>
                </div>
                
                <div class="count-item">
                    <label>Other #1</label>
                    <input type="number" id="countOther1" min="0" value="0" required>
                </div>
                
                <div class="form-group">
                    <label>Describe Other #1</label>
                    <input type="text" id="countOther1Desc" placeholder="e.g., chitons">
                </div>
                
                <div class="count-item">
                    <label>Other #2</label>
                    <input type="number" id="countOther2" min="0" value="0" required>
                </div>
                
                <div class="form-group">
                    <label>Describe Other #2</label>
                    <input type="text" id="countOther2Desc" placeholder="e.g., anemones">
                </div>
                
                <div class="count-item">
                    <label>Other #3</label>
                    <input type="number" id="countOther3" min="0" value="0" required>
                </div>
                
                <div class="form-group">
                    <label>Describe Other #3</label>
                    <input type="text" id="countOther3Desc" placeholder="e.g., worms">
                </div>
                
                <div class="stats-box">
                    <div class="stats-row">
                        <span class="stats-label">Species Richness</span>
                        <span class="stats-value"><span id="richness">0</span> taxa</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">Total Abundance</span>
                        <span class="stats-value"><span id="abundance">0</span> individuals</span>
                    </div>
                </div>
            </div>
            
            <!-- Notes -->
            <div class="card">
                <div class="section-title">üìù Notes</div>
                <textarea id="notes" rows="3" placeholder="Substrate, wave action, unusual observations..."></textarea>
            </div>
            
            <button type="submit" class="button button-primary">
                üíæ Save Quadrat
            </button>
        </form>
        
        <button class="button button-success" onclick="showExportModal()">
            üì• Export All Data (<span id="exportCount">0</span> quadrats)
        </button>
        
        <button class="button button-secondary" onclick="window.location.href='site-data.html'">
            üèñÔ∏è Go to Site Data Form
        </button>
    </div>
    
    <!-- Export Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-title">üì• Export Data</div>
            <div style="margin-bottom: 20px;">
                Download <strong><span id="exportModalCount">0</span> quadrats</strong> as CSV?
            </div>
            <button class="button button-success" onclick="downloadCSV()">Download CSV</button>
            <button class="button button-secondary" onclick="closeModal()">Cancel</button>
        </div>
    </div>
    
    <script>
        let savedData = JSON.parse(localStorage.getItem('beachBugsQuadrats') || '[]');
        updateCounter();
        
        document.getElementById('date').valueAsDate = new Date();
        
        const coverInputs = ['coverAlgae', 'coverBarnacle', 'coverMussel', 'coverBareRock', 'coverSand', 'coverOther'];
        coverInputs.forEach(id => {
            document.getElementById(id).addEventListener('input', updateCoverTotal);
        });
        
        function updateCoverTotal() {
            let total = 0;
            coverInputs.forEach(id => {
                total += parseInt(document.getElementById(id).value) || 0;
            });
            
            const check = document.getElementById('totalCheck');
            if (total === 100) {
                check.className = 'total-check total-good';
                check.textContent = `‚úì Total: ${total}%`;
            } else {
                check.className = 'total-check total-bad';
                check.textContent = `Total: ${total}% (Need ${100-total} more)`;
            }
        }
        
        const countInputs = ['countSnails', 'countLimpets', 'countCrabs', 'countIsopods', 'countStars', 
                             'countOther1', 'countOther2', 'countOther3'];
        countInputs.forEach(id => {
            document.getElementById(id).addEventListener('input', updateStats);
        });
        
        function updateStats() {
            let richness = 0;
            let abundance = 0;
            
            countInputs.forEach(id => {
                const val = parseInt(document.getElementById(id).value) || 0;
                abundance += val;
                if (val > 0) richness++;
            });
            
            document.getElementById('richness').textContent = richness;
            document.getElementById('abundance').textContent = abundance;
        }
        
        const photoInput = document.getElementById('photoInput');
        const photoPreview = document.getElementById('photoPreview');
        const photoSection = document.getElementById('photoSection');
        const photoText = document.getElementById('photoText');
        
        photoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    photoPreview.src = e.target.result;
                    photoPreview.classList.add('show');
                    photoSection.classList.add('has-photo');
                    photoText.textContent = '‚úì Photo captured';
                };
                reader.readAsDataURL(file);
            }
        });
        
        document.getElementById('dataForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const coverTotal = coverInputs.reduce((sum, id) => 
                sum + (parseInt(document.getElementById(id).value) || 0), 0);
            if (coverTotal !== 100) {
                if (!confirm(`Cover total is ${coverTotal}%. Save anyway?`)) return;
            }
            
            const formData = {
                timestamp: new Date().toISOString(),
                siteId: document.getElementById('siteId').value,
                siteName: document.getElementById('siteName').value,
                date: document.getElementById('date').value,
                samplerName: document.getElementById('samplerName').value,
                side: document.getElementById('side').value,
                distance: document.getElementById('distance').value,
                zone: document.getElementById('zone').value,
                photo: photoPreview.src || '',
                coverAlgae: document.getElementById('coverAlgae').value,
                coverBarnacle: document.getElementById('coverBarnacle').value,
                coverMussel: document.getElementById('coverMussel').value,
                coverBareRock: document.getElementById('coverBareRock').value,
                coverSand: document.getElementById('coverSand').value,
                coverOther: document.getElementById('coverOther').value,
                coverOtherDesc: document.getElementById('coverOtherDesc').value,
                countSnails: document.getElementById('countSnails').value,
                countLimpets: document.getElementById('countLimpets').value,
                countCrabs: document.getElementById('countCrabs').value,
                countIsopods: document.getElementById('countIsopods').value,
                countStars: document.getElementById('countStars').value,
                countOther1: document.getElementById('countOther1').value,
                countOther1Desc: document.getElementById('countOther1Desc').value,
                countOther2: document.getElementById('countOther2').value,
                countOther2Desc: document.getElementById('countOther2Desc').value,
                countOther3: document.getElementById('countOther3').value,
                countOther3Desc: document.getElementById('countOther3Desc').value,
                richness: document.getElementById('richness').textContent,
                abundance: document.getElementById('abundance').textContent,
                notes: document.getElementById('notes').value
            };
            
            savedData.push(formData);
            localStorage.setItem('beachBugsQuadrats', JSON.stringify(savedData));
            
            updateCounter();
            showStatusBar();
            
            document.getElementById('dataForm').reset();
            photoPreview.classList.remove('show');
            photoSection.classList.remove('has-photo');
            photoText.textContent = 'Tap to take photo';
            document.getElementById('date').valueAsDate = new Date();
            updateCoverTotal();
            updateStats();
            
            window.scrollTo({top: 0, behavior: 'smooth'});
        });
        
        function updateCounter() {
            const count = savedData.length;
            document.getElementById('savedCount').textContent = count;
            document.getElementById('exportCount').textContent = count;
            document.getElementById('exportModalCount').textContent = count;
        }
        
        function showStatusBar() {
            const bar = document.getElementById('statusBar');
            bar.classList.add('show');
            setTimeout(() => bar.classList.remove('show'), 3000);
        }
        
        function showExportModal() {
            if (savedData.length === 0) {
                alert('No data to export yet!');
                return;
            }
            document.getElementById('exportModal').classList.add('show');
        }
        
        function closeModal() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('show'));
        }
        
        function downloadCSV() {
            const headers = ['Timestamp', 'Site_ID', 'Site_Name', 'Date', 'Sampler_Name', 'Side', 
                           'Distance_m', 'Zone', 'Algae_pct', 'Barnacle_pct', 'Mussel_pct', 
                           'BareRock_pct', 'Sand_pct', 'Other_pct', 'Other_Cover_Description',
                           'Snails', 'Limpets', 'Crabs', 'Isopods', 'Sea_Stars',
                           'Other_1', 'Other_1_Description', 'Other_2', 'Other_2_Description',
                           'Other_3', 'Other_3_Description', 'Species_Richness', 
                           'Total_Abundance', 'Notes'];
            
            let csv = headers.join(',') + '\n';
            
            savedData.forEach(row => {
                const values = [
                    row.timestamp,
                    row.siteId,
                    `"${row.siteName}"`,
                    row.date,
                    `"${row.samplerName}"`,
                    row.side,
                    row.distance,
                    row.zone,
                    row.coverAlgae,
                    row.coverBarnacle,
                    row.coverMussel,
                    row.coverBareRock,
                    row.coverSand,
                    row.coverOther,
                    `"${row.coverOtherDesc || ''}"`,
                    row.countSnails,
                    row.countLimpets,
                    row.countCrabs,
                    row.countIsopods,
                    row.countStars,
                    row.countOther1,
                    `"${row.countOther1Desc || ''}"`,
                    row.countOther2,
                    `"${row.countOther2Desc || ''}"`,
                    row.countOther3,
                    `"${row.countOther3Desc || ''}"`,
                    row.richness,
                    row.abundance,
                    `"${row.notes || ''}"`
                ];
                csv += values.join(',') + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `beach_bugs_quadrats_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            closeModal();
            alert(`Downloaded ${savedData.length} quadrats!`);
        }
        
        updateCoverTotal();
        updateStats();
    </script>
</body>
</html>
